{"version":3,"file":"signals-transform.js","sources":["../src/index.ts"],"sourcesContent":["import {\n\ttypes as BabelTypes,\n\ttemplate as BabelTemplate,\n\tPluginObj,\n\tPluginPass,\n\tNodePath,\n\ttemplate,\n} from \"@babel/core\";\nimport { isModule, addNamed } from \"@babel/helper-module-imports\";\nimport type { VisitNodeObject } from \"@babel/traverse\";\nimport debug from \"debug\";\n\ninterface PluginArgs {\n\ttypes: typeof BabelTypes;\n\ttemplate: typeof BabelTemplate;\n}\n\nconst optOutCommentIdentifier = /(^|\\s)@no(Use|Track)Signals(\\s|$)/;\nconst optInCommentIdentifier = /(^|\\s)@(use|track)Signals(\\s|$)/;\nconst dataNamespace = \"@preact/signals-react-transform\";\nconst defaultImportSource = \"@preact/signals-react/runtime\";\nconst importName = \"useSignals\";\nconst getHookIdentifier = \"getHookIdentifier\";\nconst maybeUsesSignal = \"maybeUsesSignal\";\nconst containsJSX = \"containsJSX\";\nconst alreadyTransformed = \"alreadyTransformed\";\n\nconst UNMANAGED = \"0\";\nconst MANAGED_COMPONENT = \"1\";\nconst MANAGED_HOOK = \"2\";\ntype HookUsage =\n\t| typeof UNMANAGED\n\t| typeof MANAGED_COMPONENT\n\t| typeof MANAGED_HOOK;\n\nconst logger = {\n\ttransformed: debug(\"signals:react-transform:transformed\"),\n\tskipped: debug(\"signals:react-transform:skipped\"),\n};\n\nconst get = (pass: PluginPass, name: any) =>\n\tpass.get(`${dataNamespace}/${name}`);\nconst set = (pass: PluginPass, name: string, v: any) =>\n\tpass.set(`${dataNamespace}/${name}`, v);\n\ninterface DataContainer {\n\tgetData(name: string): any;\n\tsetData(name: string, value: any): void;\n}\nconst setData = (node: DataContainer, name: string, value: any) =>\n\tnode.setData(`${dataNamespace}/${name}`, value);\nconst getData = (node: DataContainer, name: string) =>\n\tnode.getData(`${dataNamespace}/${name}`);\n\nfunction setOnFunctionScope(path: NodePath, key: string, value: any) {\n\tconst functionScope = path.scope.getFunctionParent();\n\tif (functionScope) {\n\t\tsetData(functionScope, key, value);\n\t}\n}\n\ntype FunctionLike =\n\t| BabelTypes.ArrowFunctionExpression\n\t| BabelTypes.FunctionExpression\n\t| BabelTypes.FunctionDeclaration\n\t| BabelTypes.ObjectMethod;\n\n/**\n * Simple \"best effort\" to get the base name of a file path. Not fool proof but\n * works in browsers and servers. Good enough for our purposes.\n */\nfunction basename(filename: string | undefined): string | undefined {\n\treturn filename?.split(/[\\\\/]/).pop();\n}\n\nconst DefaultExportSymbol = Symbol(\"DefaultExportSymbol\");\n\nfunction getObjectPropertyKey(\n\tnode: BabelTypes.ObjectProperty | BabelTypes.ObjectMethod\n): string | null {\n\tif (node.key.type === \"Identifier\") {\n\t\treturn node.key.name;\n\t} else if (node.key.type === \"StringLiteral\") {\n\t\treturn node.key.value;\n\t}\n\n\treturn null;\n}\n\n/**\n * If the function node has a name (i.e. is a function declaration with a\n * name), return that. Else return null.\n */\nfunction getFunctionNodeName(node: FunctionLike): string | null {\n\tif (\n\t\t(node.type === \"FunctionDeclaration\" ||\n\t\t\tnode.type === \"FunctionExpression\") &&\n\t\tnode.id\n\t) {\n\t\treturn node.id.name;\n\t} else if (node.type === \"ObjectMethod\") {\n\t\treturn getObjectPropertyKey(node);\n\t}\n\n\treturn null;\n}\n\n/**\n * Given a function path's parent path, determine the \"name\" associated with the\n * function. If the function is an inline default export (e.g. `export default\n * () => {}`), returns a symbol indicating it is a default export. If the\n * function is an anonymous function wrapped in higher order functions (e.g.\n * memo(() => {})) we'll climb through the higher order functions to find the\n * name of the variable that the function is assigned to, if any. Other cases\n * handled too (see implementation). Else returns null.\n */\nfunction getFunctionNameFromParent(\n\tparentPath: NodePath<BabelTypes.Node>\n): string | null | typeof DefaultExportSymbol {\n\tif (\n\t\tparentPath.node.type === \"VariableDeclarator\" &&\n\t\tparentPath.node.id.type === \"Identifier\"\n\t) {\n\t\treturn parentPath.node.id.name;\n\t} else if (parentPath.node.type === \"AssignmentExpression\") {\n\t\tconst left = parentPath.node.left;\n\t\tif (left.type === \"Identifier\") {\n\t\t\treturn left.name;\n\t\t} else if (left.type === \"MemberExpression\") {\n\t\t\tlet property = left.property;\n\t\t\twhile (property.type === \"MemberExpression\") {\n\t\t\t\tproperty = property.property;\n\t\t\t}\n\n\t\t\tif (property.type === \"Identifier\") {\n\t\t\t\treturn property.name;\n\t\t\t} else if (property.type === \"StringLiteral\") {\n\t\t\t\treturn property.value;\n\t\t\t}\n\n\t\t\treturn null;\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t} else if (parentPath.node.type === \"ObjectProperty\") {\n\t\treturn getObjectPropertyKey(parentPath.node);\n\t} else if (parentPath.node.type === \"ExportDefaultDeclaration\") {\n\t\treturn DefaultExportSymbol;\n\t} else if (\n\t\tparentPath.node.type === \"CallExpression\" &&\n\t\tparentPath.parentPath != null\n\t) {\n\t\t// If our parent is a Call Expression, then this function expression is\n\t\t// wrapped in some higher order functions. Recurse through the higher order\n\t\t// functions to determine if this expression is assigned to a name we can\n\t\t// use as the function name\n\t\treturn getFunctionNameFromParent(parentPath.parentPath);\n\t} else {\n\t\treturn null;\n\t}\n}\n\n/* Determine the name of a function */\nfunction getFunctionName(\n\tpath: NodePath<FunctionLike>\n): string | typeof DefaultExportSymbol | null {\n\tlet nodeName = getFunctionNodeName(path.node);\n\tif (nodeName) {\n\t\treturn nodeName;\n\t}\n\n\treturn getFunctionNameFromParent(path.parentPath);\n}\n\nfunction isComponentName(name: string | null): boolean {\n\treturn name?.match(/^[A-Z]/) != null ?? false;\n}\nfunction isCustomHookName(name: string | null): boolean {\n\treturn name?.match(/^use[A-Z]/) != null ?? null;\n}\n\nfunction hasLeadingComment(path: NodePath, comment: RegExp): boolean {\n\tconst comments = path.node.leadingComments;\n\treturn comments?.some(c => c.value.match(comment) !== null) ?? false;\n}\n\nfunction hasLeadingOptInComment(path: NodePath) {\n\treturn hasLeadingComment(path, optInCommentIdentifier);\n}\n\nfunction hasLeadingOptOutComment(path: NodePath) {\n\treturn hasLeadingComment(path, optOutCommentIdentifier);\n}\n\nfunction isOptedIntoSignalTracking(path: NodePath | null): boolean {\n\tif (!path) return false;\n\n\tswitch (path.node.type) {\n\t\tcase \"ArrowFunctionExpression\":\n\t\tcase \"FunctionExpression\":\n\t\tcase \"FunctionDeclaration\":\n\t\tcase \"ObjectMethod\":\n\t\tcase \"ObjectExpression\":\n\t\tcase \"VariableDeclarator\":\n\t\tcase \"VariableDeclaration\":\n\t\tcase \"AssignmentExpression\":\n\t\tcase \"CallExpression\":\n\t\t\treturn (\n\t\t\t\thasLeadingOptInComment(path) ||\n\t\t\t\tisOptedIntoSignalTracking(path.parentPath)\n\t\t\t);\n\t\tcase \"ExportDefaultDeclaration\":\n\t\tcase \"ExportNamedDeclaration\":\n\t\tcase \"ObjectProperty\":\n\t\tcase \"ExpressionStatement\":\n\t\t\treturn hasLeadingOptInComment(path);\n\t\tdefault:\n\t\t\treturn false;\n\t}\n}\n\nfunction isOptedOutOfSignalTracking(path: NodePath | null): boolean {\n\tif (!path) return false;\n\n\tswitch (path.node.type) {\n\t\tcase \"ArrowFunctionExpression\":\n\t\tcase \"FunctionExpression\":\n\t\tcase \"FunctionDeclaration\":\n\t\tcase \"ObjectMethod\":\n\t\tcase \"ObjectExpression\":\n\t\tcase \"VariableDeclarator\":\n\t\tcase \"VariableDeclaration\":\n\t\tcase \"AssignmentExpression\":\n\t\tcase \"CallExpression\":\n\t\t\treturn (\n\t\t\t\thasLeadingOptOutComment(path) ||\n\t\t\t\tisOptedOutOfSignalTracking(path.parentPath)\n\t\t\t);\n\t\tcase \"ExportDefaultDeclaration\":\n\t\tcase \"ExportNamedDeclaration\":\n\t\tcase \"ObjectProperty\":\n\t\tcase \"ExpressionStatement\":\n\t\t\treturn hasLeadingOptOutComment(path);\n\t\tdefault:\n\t\t\treturn false;\n\t}\n}\n\nfunction isComponentFunction(\n\tpath: NodePath<FunctionLike>,\n\tfunctionName: string | null\n): boolean {\n\treturn (\n\t\tgetData(path.scope, containsJSX) === true && // Function contains JSX\n\t\tisComponentName(functionName) // Function name indicates it's a component\n\t);\n}\n\nfunction shouldTransform(\n\tpath: NodePath<FunctionLike>,\n\tfunctionName: string | null,\n\toptions: PluginOptions\n): boolean {\n\t// Opt-out takes first precedence\n\tif (isOptedOutOfSignalTracking(path)) return false;\n\t// Opt-in opts in to transformation regardless of mode\n\tif (isOptedIntoSignalTracking(path)) return true;\n\n\tif (options.mode === \"all\") {\n\t\treturn isComponentFunction(path, functionName);\n\t}\n\n\tif (options.mode == null || options.mode === \"auto\") {\n\t\treturn (\n\t\t\tgetData(path.scope, maybeUsesSignal) === true && // Function appears to use signals;\n\t\t\t(isComponentFunction(path, functionName) ||\n\t\t\t\tisCustomHookName(functionName))\n\t\t);\n\t}\n\n\treturn false;\n}\n\nfunction isValueMemberExpression(\n\tpath: NodePath<BabelTypes.MemberExpression>\n): boolean {\n\treturn (\n\t\t(path.node.property.type === \"Identifier\" &&\n\t\t\tpath.node.property.name === \"value\") ||\n\t\t(path.node.property.type === \"StringLiteral\" &&\n\t\t\tpath.node.property.value === \"value\")\n\t);\n}\n\nconst tryCatchTemplate = template.statements`var STORE_IDENTIFIER = HOOK_IDENTIFIER(HOOK_USAGE);\ntry {\n\tBODY\n} finally {\n\tSTORE_IDENTIFIER.f();\n}`;\n\nfunction wrapInTryFinally(\n\tt: typeof BabelTypes,\n\tpath: NodePath<FunctionLike>,\n\tstate: PluginPass,\n\thookUsage: HookUsage\n): FunctionLike {\n\tconst stopTrackingIdentifier = path.scope.generateUidIdentifier(\"effect\");\n\n\tconst newFunction = t.cloneNode(path.node);\n\tnewFunction.body = t.blockStatement(\n\t\ttryCatchTemplate({\n\t\t\tSTORE_IDENTIFIER: stopTrackingIdentifier,\n\t\t\tHOOK_IDENTIFIER: get(state, getHookIdentifier)(),\n\t\t\tHOOK_USAGE: hookUsage,\n\t\t\tBODY: t.isBlockStatement(path.node.body)\n\t\t\t\t? path.node.body.body // TODO: Is it okay to elide the block statement here?\n\t\t\t\t: t.returnStatement(path.node.body),\n\t\t})\n\t);\n\n\treturn newFunction;\n}\n\nfunction prependUseSignals<T extends FunctionLike>(\n\tt: typeof BabelTypes,\n\tpath: NodePath<T>,\n\tstate: PluginPass\n): T {\n\tconst newFunction = t.cloneNode(path.node);\n\tnewFunction.body = t.blockStatement([\n\t\tt.expressionStatement(\n\t\t\tt.callExpression(get(state, getHookIdentifier)(), [])\n\t\t),\n\t]);\n\tif (t.isBlockStatement(path.node.body)) {\n\t\t// TODO: Is it okay to elide the block statement here?\n\t\tnewFunction.body.body.push(...path.node.body.body);\n\t} else {\n\t\tnewFunction.body.body.push(t.returnStatement(path.node.body));\n\t}\n\n\treturn newFunction;\n}\n\nfunction transformFunction(\n\tt: typeof BabelTypes,\n\toptions: PluginOptions,\n\tpath: NodePath<FunctionLike>,\n\tfunctionName: string | null,\n\tstate: PluginPass\n) {\n\tconst isHook = isCustomHookName(functionName);\n\tconst isComponent = isComponentName(functionName);\n\tconst hookUsage = options.experimental?.noTryFinally\n\t\t? UNMANAGED\n\t\t: isHook\n\t\t? MANAGED_HOOK\n\t\t: isComponent\n\t\t? MANAGED_COMPONENT\n\t\t: UNMANAGED;\n\n\tlet newFunction: FunctionLike;\n\tif (hookUsage !== UNMANAGED) {\n\t\tnewFunction = wrapInTryFinally(t, path, state, hookUsage);\n\t} else {\n\t\tnewFunction = prependUseSignals(t, path, state);\n\t}\n\n\t// Using replaceWith keeps the existing leading comments already so\n\t// we'll clear our cloned node's leading comments to ensure they\n\t// aren't duplicated in the output.\n\tnewFunction.leadingComments = [];\n\n\tsetData(path, alreadyTransformed, true);\n\tpath.replaceWith(newFunction);\n}\n\nfunction createImportLazily(\n\ttypes: typeof BabelTypes,\n\tpass: PluginPass,\n\tpath: NodePath<BabelTypes.Program>,\n\timportName: string,\n\tsource: string\n): () => BabelTypes.Identifier {\n\treturn () => {\n\t\tif (!isModule(path)) {\n\t\t\tthrow new Error(\n\t\t\t\t`Cannot import ${importName} outside of an ESM module file`\n\t\t\t);\n\t\t}\n\n\t\tlet reference: BabelTypes.Identifier = get(pass, `imports/${importName}`);\n\t\tif (reference) return types.cloneNode(reference);\n\t\treference = addNamed(path, importName, source, {\n\t\t\timportedInterop: \"uncompiled\",\n\t\t\timportPosition: \"after\",\n\t\t});\n\t\tset(pass, `imports/${importName}`, reference);\n\n\t\t/** Helper function to determine if an import declaration's specifier matches the given importName  */\n\t\tconst matchesImportName = (\n\t\t\ts: BabelTypes.ImportDeclaration[\"specifiers\"][0]\n\t\t) => {\n\t\t\tif (s.type !== \"ImportSpecifier\") return false;\n\t\t\treturn (\n\t\t\t\t(s.imported.type === \"Identifier\" && s.imported.name === importName) ||\n\t\t\t\t(s.imported.type === \"StringLiteral\" && s.imported.value === importName)\n\t\t\t);\n\t\t};\n\n\t\tfor (let statement of path.get(\"body\")) {\n\t\t\tif (\n\t\t\t\tstatement.isImportDeclaration() &&\n\t\t\t\tstatement.node.source.value === source &&\n\t\t\t\tstatement.node.specifiers.some(matchesImportName)\n\t\t\t) {\n\t\t\t\tpath.scope.registerDeclaration(statement);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn reference;\n\t};\n}\n\nexport interface PluginOptions {\n\t/**\n\t * Specify the mode to use:\n\t * - `auto`: Automatically wrap all components that use signals.\n\t * - `manual`: Only wrap components that are annotated with `@useSignals` in a JSX comment.\n\t * - `all`: Makes all components reactive to signals.\n\t */\n\tmode?: \"auto\" | \"manual\" | \"all\";\n\t/** Specify a custom package to import the `useSignals` hook from. */\n\timportSource?: string;\n\texperimental?: {\n\t\t/**\n\t\t * If set to true, the component body will not be wrapped in a try/finally\n\t\t * block and instead the next component render or a microtick will stop\n\t\t * tracking signals for this component. This is an experimental feature and\n\t\t * may be removed in the future.\n\t\t * @default false\n\t\t */\n\t\tnoTryFinally?: boolean;\n\t};\n}\n\nfunction log(\n\ttransformed: boolean,\n\tpath: NodePath<FunctionLike>,\n\tfunctionName: string | null,\n\tcurrentFile: string | undefined\n) {\n\tif (!logger.transformed.enabled && !logger.skipped.enabled) return;\n\n\tlet cwd = \"\";\n\tif (typeof process !== undefined && typeof process.cwd == \"function\") {\n\t\tcwd = process.cwd().replace(/\\\\([^ ])/g, \"/$1\");\n\t\tcwd = cwd.endsWith(\"/\") ? cwd : cwd + \"/\";\n\t}\n\n\tconst relativePath = currentFile?.replace(cwd, \"\") ?? \"\";\n\tconst lineNum = path.node.loc?.start.line;\n\tfunctionName = functionName ?? \"<anonymous>\";\n\n\tif (transformed) {\n\t\tlogger.transformed(`${functionName} (${relativePath}:${lineNum})`);\n\t} else {\n\t\tlogger.skipped(`${functionName} (${relativePath}:${lineNum}) %o`, {\n\t\t\thasSignals: getData(path.scope, maybeUsesSignal) ?? false,\n\t\t\thasJSX: getData(path.scope, containsJSX) ?? false,\n\t\t});\n\t}\n}\n\nfunction isComponentLike(\n\tpath: NodePath<FunctionLike>,\n\tfunctionName: string | null\n): boolean {\n\treturn !getData(path, alreadyTransformed) && isComponentName(functionName);\n}\n\nexport default function signalsTransform(\n\t{ types: t }: PluginArgs,\n\toptions: PluginOptions\n): PluginObj {\n\t// TODO: Consider alternate implementation, where on enter of a function\n\t// expression, we run our own manual scan the AST to determine if the\n\t// function uses signals and is a component. This manual scan once upon\n\t// seeing a function would probably be faster than running an entire\n\t// babel pass with plugins on components twice.\n\tconst visitFunction: VisitNodeObject<PluginPass, FunctionLike> = {\n\t\texit(path, state) {\n\t\t\tif (getData(path, alreadyTransformed) === true) return false;\n\n\t\t\tlet functionName = getFunctionName(path);\n\t\t\tif (functionName === DefaultExportSymbol) {\n\t\t\t\tfunctionName = basename(this.filename) ?? null;\n\t\t\t}\n\n\t\t\tif (shouldTransform(path, functionName, state.opts)) {\n\t\t\t\ttransformFunction(t, state.opts, path, functionName, state);\n\t\t\t\tlog(true, path, functionName, this.filename);\n\t\t\t} else if (isComponentLike(path, functionName)) {\n\t\t\t\tlog(false, path, functionName, this.filename);\n\t\t\t}\n\t\t},\n\t};\n\n\treturn {\n\t\tname: \"@preact/signals-transform\",\n\t\tvisitor: {\n\t\t\tProgram: {\n\t\t\t\tenter(path, state) {\n\t\t\t\t\t// Following the pattern of babel-plugin-transform-react-jsx, we\n\t\t\t\t\t// lazily create the import statement for the useSignalTracking hook.\n\t\t\t\t\t// We create a function and store it in the PluginPass object, so that\n\t\t\t\t\t// on the first usage of the hook, we can create the import statement.\n\t\t\t\t\tset(\n\t\t\t\t\t\tstate,\n\t\t\t\t\t\tgetHookIdentifier,\n\t\t\t\t\t\tcreateImportLazily(\n\t\t\t\t\t\t\tt,\n\t\t\t\t\t\t\tstate,\n\t\t\t\t\t\t\tpath,\n\t\t\t\t\t\t\timportName,\n\t\t\t\t\t\t\toptions.importSource ?? defaultImportSource\n\t\t\t\t\t\t)\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t},\n\n\t\t\tArrowFunctionExpression: visitFunction,\n\t\t\tFunctionExpression: visitFunction,\n\t\t\tFunctionDeclaration: visitFunction,\n\t\t\tObjectMethod: visitFunction,\n\n\t\t\tMemberExpression(path) {\n\t\t\t\tif (isValueMemberExpression(path)) {\n\t\t\t\t\tsetOnFunctionScope(path, maybeUsesSignal, true);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tJSXElement(path) {\n\t\t\t\tsetOnFunctionScope(path, containsJSX, true);\n\t\t\t},\n\t\t\tJSXFragment(path) {\n\t\t\t\tsetOnFunctionScope(path, containsJSX, true);\n\t\t\t},\n\t\t},\n\t};\n}\n"],"names":["optOutCommentIdentifier","optInCommentIdentifier","dataNamespace","defaultImportSource","importName","getHookIdentifier","maybeUsesSignal","containsJSX","alreadyTransformed","UNMANAGED","MANAGED_COMPONENT","MANAGED_HOOK","logger","transformed","debug","skipped","get","pass","name","set","v","setData","node","value","getData","setOnFunctionScope","path","key","functionScope","scope","getFunctionParent","basename","filename","split","pop","DefaultExportSymbol","Symbol","getObjectPropertyKey","type","getFunctionNodeName","id","getFunctionNameFromParent","parentPath","left","property","getFunctionName","nodeName","isComponentName","_ref","match","isCustomHookName","_ref2","hasLeadingComment","comment","_comments$some","comments","leadingComments","some","c","hasLeadingOptInComment","hasLeadingOptOutComment","isOptedIntoSignalTracking","isOptedOutOfSignalTracking","isComponentFunction","functionName","shouldTransform","options","mode","isValueMemberExpression","tryCatchTemplate","template","statements","_templateObject","_taggedTemplateLiteralLoose","wrapInTryFinally","t","state","hookUsage","stopTrackingIdentifier","generateUidIdentifier","newFunction","cloneNode","body","blockStatement","STORE_IDENTIFIER","HOOK_IDENTIFIER","HOOK_USAGE","BODY","isBlockStatement","returnStatement","prependUseSignals","expressionStatement","callExpression","_newFunction$body$bod","push","apply","transformFunction","_options$experimental","isHook","isComponent","experimental","noTryFinally","replaceWith","createImportLazily","types","source","isModule","Error","reference","addNamed","importedInterop","importPosition","matchesImportName","s","imported","_iterator","_createForOfIteratorHelperLoose","_step","done","statement","isImportDeclaration","specifiers","registerDeclaration","log","currentFile","_currentFile$replace","_path$node$loc","_functionName","enabled","cwd","process","undefined","replace","endsWith","relativePath","lineNum","loc","start","line","_getData","_getData2","hasSignals","hasJSX","isComponentLike","signalsTransform","_ref3","visitFunction","exit","_basename","opts","visitor","Program","enter","_options$importSource","importSource","ArrowFunctionExpression","FunctionExpression","FunctionDeclaration","ObjectMethod","MemberExpression","JSXElement","JSXFragment"],"mappings":"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"}